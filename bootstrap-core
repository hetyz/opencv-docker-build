#!/bin/sh
set -euo pipefail

RIC="${AWS_LAMBDA_RUNTIME_API}"

echo "[BOOTSTRAP] Starting minimal bootstrap"
H=$(mktemp)
B=$(mktemp)

# Lekérjük az invocation-t
curl -sfS -D "$H" -o "$B" "http://$RIC/2018-06-01/runtime/invocation/next" >/dev/null

# Kinyerjük a request ID-t
REQ_ID=$(sed -n 's/\r$//;s/^Lambda-Runtime-Aws-Request-Id: //p' "$H" | head -n1)
[ -n "$REQ_ID" ] || { echo "[BOOTSTRAP] missing request id"; exit 125; }

# Válasz JSON
RESP='{"status":"ok"}'
echo "[BOOTSTRAP] Sending response: $RESP"

# Válasz elküldése
printf "%s" "$RESP" | curl -sfS -X POST "http://$RIC/2018-06-01/runtime/invocation/$REQ_ID/response" \
  -H "Content-Type: application/json" \
  -d @-

rm -f "$H" "$B"
